2020.07.03
=========

워드프레스 구축
------------

1) 실습환경

<img src=/img/20200703.png>

2) DB 구축
* 마운트 후 쉘스크립트 실행
<pre>
<code>
#!/bin/bash
setenforce 0
mkdir /var/lib/mysql
mkfs.xfs /dev/vdc
echo '/dev/vdc /var/lib/mysql xfs defaults 0 1' >> /etc/fstab
mount -a
yum-config-manager --add-repo=http://yum.mariadb.org/10.5/centos7-amd64
echo 'gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB' >> /etc/yum.repos.d/yum.mariadb.org_10.5_centos7-amd64.repo
echo 'gpgcheck=1' >> /etc/yum.repos.d/yum.mariadb.org_10.5_centos7-amd64.repo
yum install -y MariaDB-server
systemctl start mariadb
systemctl enable mariadb
mysql -u root -e "CREATE DATABASE wordpress_db"
mysql -u root -e "CREATE USER 'wp-admin'@'%' IDENTIFIED BY 'dkagh1.'"
mysql -u root -e "GRANT ALL PRIVILEGES ON wordpress_db.* TO 'wp-admin'@'%' IDENTIFIED BY 'dkagh1.'"
mysql -u root -e "FLUSH PRIVILEGES"
</code>
</pre>

3) WEB 구축
* 마운트 후 쉘스크립트 실행
<pre>
<code>
#!/bin/bash
setenforce 0
mkdir /var/www
mkfs.xfs /dev/vdc
echo '/dev/vdc /var/www xfs defaults 0 1' >> /etc/fstab
mount -a
yum install -y httpd epel-release wget
wget https://rpms.remirepo.net/enterprise/remi-release-7.rpm -P /home/centos/
rpm -i /home/centos/remi-release-7.rpm
rm -rf /home/centos/remi-release-7.rpm
yum-config-manager --disable remi-safe
yum-config-manager --enable remi-php74
yum install -y php php-mysql
wget https://wordpress.org/latest.tar.gz -P /home/centos/
tar -xf /home/centos/latest.tar.gz -C /var/www/html
rm -rf /home/centos/latest.tar.gz
chown -r apache:apache /var/www/html/wordpress
cp /var/www/html/wordpress/wp-config-sample.php /var/www/html/wordpress/wp-config.php
sed -i s/database_name_here/wordpress_db/g /var/www/html/wordpress/wp-config.php
sed -i s/username_here/wp-admin/g /var/www/html/wordpress/wp-config.php
sed -i s/password_here/dkagh1./g /var/www/html/wordpress/wp-config.php
sed -i s/localhost/db서버 주소/g /var/www/html/wordpress/wp-config.php
systemctl start httpd
systemctl enable httpd
</code>
</pre>


HEAT (Orchestration)
--------------------
1) Controller Node : HEAT 설치 및 Apache2 재시작
yum install -y openstack-heat-ui
systemctl restart httpd


2) 대시보드 접근 및 template generate 


* Stack : 서비스의 묶음 (Instance / Network / Volume / etc... ) / Stacking을 위해 템플릿 파일 (HOT - Heat Orchestration Template) 이 필요함
* HOT는 Yaml 문법으로 작성됨
* Yaml : 
<pre>
<code>
* Yaml : 계층을 나타내는 문법
* 규칙 : Key: Value (key 뒤에 :는 무조건 붙이고, :와 value는 띄운다.)

-------------------------------------------------------------------
 1. list 형태
 
   key:
     - value1
     - value2
     - value3
     
   key: [value1, value2, value3]
   
--------------------------------------------------------------------
2. hash/dictionary 형태
  
  key:
    key1: value1
    ket2: value2
    
  key: {key1: value1, ket2: value2}

----------------------------------------------------------------------
3. hash + list 형태

  key:
    - key1: value1
      ket2: value2
    - key3: value3
      key4: value4
    
  key:
    - {key1: value1, key2, value2}
    - {key3: value3, key4, value4}
  
  key: [{key1: value1, key2: value2}, {key3: value3, key4: value4}]
  
-----------------------------------------------------------------------
</code>
</pre>


* HOT 파일 구조
<pre>
</code>
heat_templeate_version: 2016-06-14      # template의 변수를 지정
parameters:                             # 템플릿의 매개변수 지정
resources:                              # 
outputs:                                # 
 
 

꿀팁
---
db로 유저생성 시 호스트네임 부분에 % 입력하면, 모든 ip를 부여한다.
e.g) mysql -u root -e "CREATE USER 'wp-admin'@% IDENTIFIED BY 'dkagh1.'"
