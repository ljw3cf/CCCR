2020.07.24
-----------

클러스터 외부 서비스
=================
1) 서비스의 종류
* ClusterIP
> 클러스터 내부용 서비스
* NodePort
> 쿠버네티스 모든 노드에 외부 접근용 포트를 할당
> 노드의 포트를 사용하면 외부에서 접근 가능
> 노드의 포트로 접근하면 서비스에 의해 파드로 리다이렉션 함
> 파드를 실행하고 있지 않은 노드에도 포트가 할당되고, 접근 가능
* LoadBalancer
> 클러스터 외부에 LB를 배치한다. (기본적으로 Cloud환경에서 가능)
> 각 nodes에 speaker라는 pods 형태로 lb를 배치
> 외부에서 lb를 통해 접근시 speaker->NodePort->Pods 순서로 리다이렉션 진행됨

* ExternalName

2) NodePort
* NodePort 접근방식
<pre>
<code>
<조건>
1) 노드에 노출할 포트: 31111
2) 서비스 포트: 80
3) 타겟포트: 8080
<과정>
1) 외부에서 노출된 포트 31111을 통해 각 노드에 접근 (포드가 아님에 유의!)
2) NodePort에서 설정된 서비스 포트 80으로 리다이렉션
3) NodePort 80번에서 내부 Pods의 8080번으로 리다이렉션
</code>
</pre>

3) LoadBalancer
<pre>
<code>
<조건>
1) 서비스 포트:80
2) 타겟포트: 8080
<과정>
1) 외부에서 lb의 ip로 lb에 접근
2) lb는 Nodeport에서 설정된 서비스 포트 80번으로 리다이렉션
3) Nodeport 80번에서 내부 Pods의 8080번으로 리다이렉션
</code>
</pre>
