2020.06.25 
==========

단어정리
-------
1) OVA (Open Virtualization Appliance)
+ 구성요소 : </br>
    (1)VM Metadata (CPU/MEMORY/DISK에 대한 정보 (/etc/libvirt/qemu/*.xml)) </br>
    </br>
    (2)Disk File(/etc/libvirt/images)

2) Guest Driver & Agent
+ VM 관리 및 성능 향상을 위해 게스트 운영체제에 설치
+ Guest Driver & Agent 구성요소
>Package : overt-guest-agent</br>
>          (VM Para virt Driver)</br>
>          (VM Agent)</br>
>          </br>
>Service: qemu-guest-agent</br>

+ 설치방법 </br>
    (1) 게스트 os에서 ovirt 레포지토리 등록  </br>
    <pre>
    <code>
    [student@centos7 ~]$ yum install -y https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm
    </code>
    </pre>
 2-2 등록된 ovirt 레포지토리에서 overt-guest-agent 설치
 <pre>
 <code>
 [student@centos7 ~]$ yum install -y ovirt-guest-agent
 </code>
 </pre>
 2-3 qemu-guest-agent 서비스 시작
 <pre>
 <code>
 [student@centos7 ~]$ systemctl start qemu-guest-agent
 [student@centos7 ~]$ systemctl enable qemu-guest-agent
 </code>
 </pre>
 
 2-4 게스트 접속종료 후 재부팅

 > 접속종료 후 재부팅 시 이전에는 공란이었던 IP주소 및 FQDN 정보가 확인 가능함  

3) Repository manager 비교 (update)
Ubuntu : 패키지의 목록만 업데이트 (패키지의 업그레이드는 upgrade 옵션으로)
RHEL : 모든 패키지를 업데이트

4) Sealing
 4-1) VM을 템플릿으로 만들시 기존 VM의 MAC주소, 인증서, IP, Log 등 설정은 향후 문제가 될 수 있음
 => VM 고유정보를 제거하는 작업이 필요함 (=Sealing)
 (VM 고유정보를 제거한 순수한 이미지를 골든 이미지라고 부른다.)
 </br>
 4-2) virt-sysprep을 이용하여 특정 이미지의 Sealing이 가능하다.
 4-3) virt-sysprep을 이용한 Sealing 과정</br>
 libguestfs-tools 설치</br>
 <pre>
 <code>
 yum -y install libguestfs-tools
 </code>
 </pre>
 Sealing할 이미지 Shutdown 및 VM에서 제거</br>
 virt-sysprep으로 Sealing할 이미지 지정</br>
 <pre>
 <code>
 virt-sysprep -a a.qcow2
 </code>
 </pre>
![before](https://github.com/ljw3cf/CCCR/blob/master/img/ovirt_after.png)
 (Ovirt 상에서는 자체적으로 템플릿 생성시 템플릿 봉인 기능이 포함되어 있음!)
 
5) Cloud-init
#cloud-config
runcmd:
- [ls, -l, /etc/hosts ]
- [df, -h ]


Cloud-init 스크립트는 부팅시 실행된다. 하지만 방화벽 관련 스크립트는 실행할 수 없다.(Selinux 정책 상, 부팅할때 방화벽 설정 불가능)
=> 이를 극복하기 위한 꼼수로 firewall-offline-cmd에 http포트 넣고 firewalld를 재시작한다.
<pre>
<code>
- [ firewall-offline-cmd, --add-service=http ]
- [ systemctl, restart, firewalld ]
</code>
</pre>
 
